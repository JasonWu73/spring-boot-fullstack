import{h,g as U,$ as H,k as i,l as R,_,m as W,n as F,j as e,i as b,o as V,p as N,t as Y,L as z,q as G,v as L,U as j,w as S,u as J,a as X,b as Z,S as ee,R as ae,E as se,x as te,y as re,z as ne,B as ce,O as oe,A as le,C as de}from"./index-30b8b146.js";import{b as ie,a as ue}from"./use-refresh-a73622bd.js";import{u as C}from"./use-title-ad20ba35.js";import{A as v,a as y,b as w}from"./Alert-c605ad0f.js";import{I as me,C as fe}from"./CustomFormField-c3da1ef7.js";import{C as p}from"./Code-d8898ec0.js";import{C as pe}from"./ConfirmDialog-d25c39a5.js";import{T as he,a as xe,b as ge,c as je}from"./Tooltip-6c24b483.js";import{A as be,a as $e,b as ve,c as ye}from"./Accordion-2db43653.js";function A({key:a,modifiers:s=[]},t){const r=ie({key:a,modifiers:s,callback:t});h.useEffect(()=>{function n(c){var u;const{key:l,modifiers:o,callback:d}=r.current;((u=c.key)==null?void 0:u.toLowerCase())===l.toLowerCase()&&o.every(f=>c[f])&&d()}return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[r])}const we=`${window.location.origin}`;async function Ae(a){const{status:s,data:t,error:r}=await U({...a,url:`${we}${a.url}`});return r?{status:s,error:r}:{status:s,data:t}}const k="Avatar",[Re,Ve]=H(k),[_e,I]=Re(k),Ne=i.forwardRef((a,s)=>{const{__scopeAvatar:t,...r}=a,[n,c]=i.useState("idle");return i.createElement(_e,{scope:t,imageLoadingStatus:n,onImageLoadingStatusChange:c},i.createElement(R.span,_({},r,{ref:s})))}),Se="AvatarImage",Ee=i.forwardRef((a,s)=>{const{__scopeAvatar:t,src:r,onLoadingStatusChange:n=()=>{},...c}=a,l=I(Se,t),o=Ce(r),d=W(u=>{n(u),l.onImageLoadingStatusChange(u)});return F(()=>{o!=="idle"&&d(o)},[o,d]),o==="loaded"?i.createElement(R.img,_({},c,{ref:s,src:r})):null}),Fe="AvatarFallback",Le=i.forwardRef((a,s)=>{const{__scopeAvatar:t,delayMs:r,...n}=a,c=I(Fe,t),[l,o]=i.useState(r===void 0);return i.useEffect(()=>{if(r!==void 0){const d=window.setTimeout(()=>o(!0),r);return()=>window.clearTimeout(d)}},[r]),l&&c.imageLoadingStatus!=="loaded"?i.createElement(R.span,_({},n,{ref:s})):null});function Ce(a){const[s,t]=i.useState("idle");return F(()=>{if(!a){t("error");return}let r=!0;const n=new window.Image,c=l=>()=>{r&&t(l)};return t("loading"),n.onload=c("loaded"),n.onerror=c("error"),n.src=a,()=>{r=!1}},[a]),s}const D=Ne,T=Ee,P=Le,M=i.forwardRef(({className:a,...s},t)=>e.jsx(D,{ref:t,className:b("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...s}));M.displayName=D.displayName;const O=i.forwardRef(({className:a,...s},t)=>e.jsx(T,{ref:t,className:b("aspect-square h-full w-full",a),...s}));O.displayName=T.displayName;const q=i.forwardRef(({className:a,...s},t)=>e.jsx(P,{ref:t,className:b("flex h-full w-full items-center justify-center rounded-full bg-slate-100 dark:bg-slate-800",a),...s}));q.displayName=P.displayName;function ke({friend:a,onDeleteFriend:s}){const t=V(),{dispatch:r}=N(),n=Number(t.friendId),c=a.id===n;function l(){r({type:"SHOW_ADD_FRIEND_FORM",payload:!1})}const o=Y(a.name,5),d=window.location.search;return e.jsxs("li",{className:b("group relative flex items-center justify-between gap-2 rounded px-4 py-2 hover:bg-amber-100 dark:hover:text-slate-950",c&&"bg-amber-100 dark:text-night"),children:[e.jsx(pe,{trigger:e.jsx("button",{className:"absolute left-2 top-1 hidden cursor-pointer text-xs group-hover:block",children:"‚ùå"}),title:e.jsxs("span",{children:["ÊÇ®Á°ÆÂÆöË¶ÅÂà†Èô§Â•ΩÂèã ",e.jsx(p,{children:a.name})," ÂêóÔºü"]}),onConfirm:()=>s(a)}),e.jsxs(M,{children:[e.jsx(O,{src:a.image,alt:o}),e.jsx(q,{children:o})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(he,{children:e.jsxs(xe,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs("span",{className:"text-lg font-bold",children:[o," üéÇ ",a.birthday]})}),e.jsx(je,{children:a.name})]})}),a.balance>0&&e.jsxs("p",{className:"text-green-500",children:[e.jsx(p,{children:o})," Ê¨†ÊÇ® $",a.balance]}),a.balance<0&&e.jsxs("p",{className:"text-red-500 dark:text-red-600",children:["ÊÇ®Ê¨† ",e.jsx(p,{children:o})," $",Math.abs(a.balance)]}),a.balance===0&&e.jsxs("p",{children:["‰Ω†Âíå ",e.jsx(p,{children:o})," ‰∫í‰∏çÁõ∏Ê¨†"]})]}),e.jsx(z,{to:c?`/split-bill${d}`:`/split-bill/${a.id}${d}`,state:{noRefresh:!0},onClick:l,className:G({variant:"default"}),children:c?"ÂÖ≥Èó≠":"ÈÄâÊã©"})]})}function Ie(){return e.jsx(be,{type:"single",collapsible:!0,children:e.jsxs($e,{value:"item-1",children:[e.jsx(ve,{children:"Êü•ÁúãÂèØÁî®Âø´Êç∑ÈîÆ"}),e.jsx(ye,{children:e.jsxs("ul",{className:"mt-4 space-y-2",children:[e.jsxs("li",{children:[e.jsx(p,{children:"Ctrl+\\"}),"ÔºöÂÆö‰ΩçÂà∞ÊêúÁ¥¢Ê°Ü"]}),e.jsxs("li",{children:[e.jsx(p,{children:"Esc"}),"ÔºöÊ∏ÖÁ©∫ÊêúÁ¥¢Ê°ÜÔºåÂπ∂‰ªÖÂ±ïÁ§∫Â∫îÁî®‰∏ªÁïåÈù¢"]})]})})]})})}function De(){const a=h.useRef(null),[s,t]=L(),[r,n]=h.useState(s.get(j)||""),c=S();A({key:"\\",modifiers:["ctrlKey"]},()=>{var d;document.activeElement!==a.current&&((d=a.current)==null||d.focus())}),A({key:"Escape"},()=>{n("")});function l(d){s.delete(j);const u=d.target.value;n(u);const f=u.trim();return f&&s.set(j,f),t(s,{replace:!0,state:{noRefresh:!0}})}function o(){c(`/split-bill${window.location.search}`,{replace:!0,state:{noRefresh:!0}})}return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{}),e.jsx(me,{value:r,onChange:l,onFocus:o,ref:a,placeholder:"ÊêúÁ¥¢Â•ΩÂèã...",className:"my-4 dark:border-amber-500"})]})}function Te(){C("Â•ΩÂèãÂàóË°®");const[a]=L(),s=J(),t=S(),{friends:r,dispatch:n}=N(),{error:c,loading:l,requestData:o,discardRequest:d}=X(Ae),{toast:u}=Z(),f=a.get(j)||"",$=f?r.filter(m=>m.name.toLowerCase().includes(f.toLowerCase())):r,E="/data/friends.json";ue(()=>{var x;if(((x=s.state)==null?void 0:x.noRefresh)===!0){s.state&&(s.state.noRefresh=!1);return}n({type:"SHOW_ADD_FRIEND_FORM",payload:!1});const m=Date.now();return B().then(({data:g,error:Q})=>{if(Q){n({type:"SET_FRIENDS",payload:[]});return}g&&n({type:"SET_FRIENDS",payload:g})}),()=>d({url:E},m)});async function B(){return await o({url:E})}function K(m){n({type:"DELETE_FRIEND",payload:m.id}),u({title:"Âà†Èô§Â•ΩÂèã",description:e.jsxs("span",{children:["ÊàêÂäüÂà†Èô§Â•ΩÂèã ",e.jsx(p,{children:m.name})]})}),t(`/split-bill${window.location.search}`,{replace:!0,state:{noRefresh:!0}})}return e.jsxs(e.Fragment,{children:[e.jsx(De,{}),e.jsx(fe,{children:e.jsx(ee,{className:"h-80",children:e.jsxs("div",{className:"space-y-4 p-4",children:[l&&e.jsxs(v,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(y,{children:"Âä†ËΩΩ‰∏≠..."}),e.jsx(w,{children:"Â•ΩÂèãÂàóË°®Âä†ËΩΩ‰∏≠"})]}),!l&&c&&e.jsxs(v,{variant:"destructive",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx(y,{children:"ÈîôËØØ"}),e.jsx(w,{children:c})]}),!l&&!c&&$.length===0&&e.jsxs(v,{children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(y,{children:"Ê∏©È¶®ÊèêÁ§∫ÔºÅ"}),e.jsx(w,{children:"ËøòÊ≤°ÊúâÂ•ΩÂèãÔºåÊ∑ªÂä†Â•ΩÂèãÂç≥ÂèØÂàÜÊëäË¥¶Âçï"})]}),!l&&!c&&$.length>0&&e.jsx("ul",{children:$.map((m,x,g)=>e.jsxs(h.Fragment,{children:[e.jsx(ke,{friend:m,onDeleteFriend:K}),x<g.length-1&&e.jsx(re,{className:"my-2"})]},m.id))})]})})})]})}const Pe=h.lazy(()=>le(2).then(()=>de(()=>import("./AddFriend-eb7f0f57.js"),["assets/AddFriend-eb7f0f57.js","assets/index-30b8b146.js","assets/index-10c7640e.css","assets/index-78ae11f9.js","assets/CustomFormField-c3da1ef7.js","assets/use-title-ad20ba35.js"]).then(a=>({default:a.AddFriend}))));function Ye(){C("ÂàÜÊëäË¥¶Âçï");const a=S(),{showAddFriend:s,dispatch:t}=N();A({key:"Escape"},()=>{t({type:"SHOW_ADD_FRIEND_FORM",payload:!1}),a("/split-bill",{state:{noRefresh:!0}})});function r(){t({type:"SHOW_ADD_FRIEND_FORM",payload:!s})}return e.jsxs("div",{className:"grid grid-flow-row items-center justify-center gap-6 md:grid-cols-2",children:[e.jsx("div",{className:"w-full max-w-md md:col-span-1 md:row-span-1 md:justify-self-end",children:e.jsx(Te,{})}),e.jsxs("div",{className:"flex w-full flex-col gap-6 self-start md:col-span-1 md:row-start-2 md:row-end-3 md:justify-self-end",children:[e.jsx("div",{className:"w-full max-w-md self-end",children:e.jsx(h.Suspense,{fallback:e.jsx(ne,{}),children:s&&e.jsx(Pe,{})})}),e.jsx("div",{className:"self-end",children:e.jsx(ce,{onClick:r,children:s?"ÂÖ≥Èó≠":"Ê∑ªÂä†Â•ΩÂèã"})})]}),e.jsx("div",{className:"max-w-md md:col-start-2 md:col-end-3 md:row-span-1",children:e.jsx(oe,{})})]})}export{Ye as default};
