import{o as R,w as O,a as N,b as P,j as e,E as _,B as v,R as q,T as d,V as m,Q as k,r as w}from"./index-f29c37fe.js";import{t as W,z as l}from"./index-a1d6eb7d.js";import{u as z,C as B,a as H,b as M,c as V,d as $,F as L,e as Q,x as Y,y as G}from"./CustomFormField-a6762e0b.js";import{A as J,a as K,b as X}from"./Alert-fc7e4ad1.js";import{C as Z}from"./Code-8e922a91.js";import{S as i}from"./Skeleton-15b235d6.js";import{u as ee}from"./use-refresh-e248a172.js";import{u as se}from"./use-title-bfe6ef72.js";const ae=[d,m],re=l.object({nickname:l.string().min(1,"必须输入昵称").trim(),authorities:l.array(l.record(l.string().trim())),remark:l.string().trim()}),te={nickname:"",authorities:[],remark:""};function ue(){var f,g,b;se("用户详情");const a=z({resolver:W(re),defaultValues:te}),n=R(),S=O(),T=Number(n.userId),{data:s,error:x,loading:h,requestData:A,discardRequest:U}=N(w),{loading:c,requestData:y}=N(w),{toast:u}=P(),p=`/api/v1/users/${T}`;ee(()=>{const r=Date.now();return C().then(({data:t})=>{t&&F(t)}),()=>U({url:p},r)});async function C(){return await A({url:p})}function F(r){a.reset({nickname:r.nickname,authorities:r.authorities.map(t=>({value:t,label:t===k.value?k.label:t===d.value?d.label:t===m.value?m.label:""})),remark:r.remark})}async function I({nickname:r,authorities:t,remark:o}){return await y({url:`/api/v1/users/${s.id}`,method:"PUT",bodyData:{nickname:r,authorities:t,remark:o}})}async function D(r){if(!s)return;const{status:t,error:o}=await I({nickname:r.nickname,authorities:r.authorities.map(E=>E.value),remark:r.remark});if(t!==204){u({title:"更新用户失败",description:o,variant:"destructive"});return}u({title:"更新用户成功",description:e.jsxs("span",{children:["成功更新用户 ",e.jsx(Z,{children:s.username})]})}),j()}function j(){return S("/users")}return e.jsxs(B,{className:"mx-auto w-full md:w-4/5 lg:w-2/3",children:[e.jsxs(H,{children:[e.jsx(M,{children:"用户详情"}),e.jsx(V,{children:"用户详情信息"})]}),e.jsxs($,{children:[h&&e.jsx(ie,{}),!h&&e.jsx(L,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(D),className:"flex flex-col gap-4",children:[x&&e.jsxs(J,{variant:"destructive",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx(K,{children:"获取用户详情失败"}),e.jsx(X,{children:x})]}),e.jsxs("p",{children:[e.jsx("label",{className:"inline-block w-[80px]",children:"用户名："}),e.jsx("span",{children:s==null?void 0:s.username})]}),e.jsxs("p",{children:[e.jsx("label",{children:"账号状态："}),e.jsx("span",{children:(s==null?void 0:s.status)===1?e.jsx("span",{className:"text-green-500 dark:text-green-600",children:"启用"}):e.jsx("span",{className:"text-red-500 dark:text-red-600",children:"禁用"})})]}),e.jsxs("p",{children:[e.jsx("label",{children:"创建时间："}),e.jsx("span",{children:s==null?void 0:s.createdAt})]}),e.jsxs("p",{children:[e.jsx("label",{children:"更新时间："}),e.jsx("span",{children:s==null?void 0:s.updatedAt})]}),e.jsx(Q,{control:a.control,name:"nickname",type:"text",label:"昵称",labelWidth:60,placeholder:"昵称",isError:(f=a.getFieldState("nickname"))==null?void 0:f.invalid}),e.jsx(Y,{control:a.control,name:"authorities",label:"功能权限",labelWidth:60,placeholder:"请选择功能权限",options:ae,isError:(g=a.getFieldState("authorities"))==null?void 0:g.invalid}),e.jsx(G,{control:a.control,name:"remark",label:"备注",labelWidth:60,placeholder:"备注",isError:(b=a.getFieldState("remark"))==null?void 0:b.invalid}),e.jsxs("div",{className:"flex gap-2 sm:justify-end",children:[e.jsx(v,{onClick:j,type:"button",variant:"outline",disabled:c,children:"返回"}),e.jsxs(v,{type:"submit",className:"self-end",disabled:c,children:[c&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"提交"]})]})]})})]})]})}function ie(){return e.jsxs("div",{className:"flex flex-col gap-4",children:[Array.from({length:4},(a,n)=>e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{className:"h-9 w-32"}),e.jsx(i,{className:"h-9 w-full"})]})},n)),Array.from({length:2},(a,n)=>e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"grid grid-flow-row items-center gap-2 lg:grid-cols-[auto_1fr]",children:[e.jsx(i,{className:"h-9 w-32"}),e.jsx(i,{className:"h-9"})]})},n)),e.jsxs("div",{className:"grid grid-flow-row items-center gap-2 lg:grid-cols-[auto_1fr]",children:[e.jsx(i,{className:"h-9 w-32"}),e.jsx(i,{className:"h-16"})]}),e.jsxs("div",{className:"flex gap-2 sm:justify-end",children:[e.jsx(i,{className:"h-9 w-20 self-end"}),e.jsx(i,{className:"h-9 w-20 self-end"})]})]})}export{ue as default};
