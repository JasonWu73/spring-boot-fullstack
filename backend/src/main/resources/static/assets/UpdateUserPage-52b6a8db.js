import{n as R,v as O,a as P,b as v,d as _,a4 as W,j as e,E as z,B as k,R as B,C as d,D as m,W as w}from"./index-2df15143.js";import{z as l,t as H}from"./index-baf8e82b.js";import{u as M,C as $,a as q,b as L,c as V,d as Y,F as G,e as J,x as K,y as Q}from"./CustomFormField-3e2fddec.js";import{A as X,a as Z,b as ee}from"./Alert-365d3aec.js";import{C as se}from"./Code-ef02e2a5.js";import{S as i}from"./Skeleton-1a4223dc.js";import{u as ae}from"./use-title-0288608e.js";const re=[d,m],te=l.object({nickname:l.string().min(1,"必须输入昵称").trim(),authorities:l.array(l.record(l.string().trim())),remark:l.string().trim()}),ie={nickname:"",authorities:[],remark:""};function ue(){var g,b,N;ae("用户详情");const a=M({resolver:H(te),defaultValues:ie}),n=R(),S=O(),A=Number(n.userId),{requestApi:x}=P(),{data:s,error:h,loading:u,fetchData:F,discardFetch:T}=v(x),{loading:c,fetchData:C}=v(x),{toast:j}=_(),p=`/api/v1/users/${A}`;W(()=>{const r=Date.now();return U().then(({data:t})=>{t&&y(t)}),()=>T({url:p},r)});async function U(){return await F({url:p})}function y(r){a.reset({nickname:r.nickname,authorities:r.authorities.map(t=>({value:t,label:t===w.value?w.label:t===d.value?d.label:t===m.value?m.label:""})),remark:r.remark})}async function D({nickname:r,authorities:t,remark:o}){return await C({url:`/api/v1/users/${s.id}`,method:"PUT",bodyData:{nickname:r,authorities:t,remark:o}})}async function I(r){if(!s)return;const{status:t,error:o}=await D({nickname:r.nickname,authorities:r.authorities.map(E=>E.value),remark:r.remark});if(t!==204){j({title:"更新用户失败",description:o,variant:"destructive"});return}j({title:"更新用户成功",description:e.jsxs("span",{children:["成功更新用户 ",e.jsx(se,{children:s.username})]})}),f()}function f(){return S("/users")}return e.jsxs($,{className:"mx-auto w-full md:w-4/5 lg:w-2/3",children:[e.jsxs(q,{children:[e.jsx(L,{children:"用户详情"}),e.jsx(V,{children:"用户详情信息"})]}),e.jsxs(Y,{children:[u&&e.jsx(le,{}),!u&&e.jsx(G,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(I),className:"flex flex-col gap-4",children:[h&&e.jsxs(X,{variant:"destructive",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(Z,{children:"获取用户详情失败"}),e.jsx(ee,{children:h})]}),e.jsxs("p",{children:[e.jsx("label",{className:"inline-block w-[80px]",children:"用户名："}),e.jsx("span",{children:s==null?void 0:s.username})]}),e.jsxs("p",{children:[e.jsx("label",{children:"账号状态："}),e.jsx("span",{children:(s==null?void 0:s.status)===1?e.jsx("span",{className:"text-green-500 dark:text-green-600",children:"启用"}):e.jsx("span",{className:"text-red-500 dark:text-red-600",children:"禁用"})})]}),e.jsxs("p",{children:[e.jsx("label",{children:"创建时间："}),e.jsx("span",{children:s==null?void 0:s.createdAt})]}),e.jsxs("p",{children:[e.jsx("label",{children:"更新时间："}),e.jsx("span",{children:s==null?void 0:s.updatedAt})]}),e.jsx(J,{control:a.control,name:"nickname",type:"text",label:"昵称",labelWidth:60,placeholder:"昵称",isError:(g=a.getFieldState("nickname"))==null?void 0:g.invalid}),e.jsx(K,{control:a.control,name:"authorities",label:"功能权限",labelWidth:60,placeholder:"请选择功能权限",options:re,isError:(b=a.getFieldState("authorities"))==null?void 0:b.invalid}),e.jsx(Q,{control:a.control,name:"remark",label:"备注",labelWidth:60,placeholder:"备注",isError:(N=a.getFieldState("remark"))==null?void 0:N.invalid}),e.jsxs("div",{className:"flex gap-2 sm:justify-end",children:[e.jsx(k,{onClick:f,type:"button",variant:"outline",disabled:c,children:"返回"}),e.jsxs(k,{type:"submit",className:"self-end",disabled:c,children:[c&&e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),"提交"]})]})]})})]})]})}function le(){return e.jsxs("div",{className:"flex flex-col gap-4",children:[Array.from({length:4},(a,n)=>e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{className:"h-9 w-32"}),e.jsx(i,{className:"h-9 w-full"})]})},n)),Array.from({length:2},(a,n)=>e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"grid grid-flow-row items-center gap-2 lg:grid-cols-[auto_1fr]",children:[e.jsx(i,{className:"h-9 w-32"}),e.jsx(i,{className:"h-9"})]})},n)),e.jsxs("div",{className:"grid grid-flow-row items-center gap-2 lg:grid-cols-[auto_1fr]",children:[e.jsx(i,{className:"h-9 w-32"}),e.jsx(i,{className:"h-16"})]}),e.jsxs("div",{className:"flex gap-2 sm:justify-end",children:[e.jsx(i,{className:"h-9 w-20 self-end"}),e.jsx(i,{className:"h-9 w-20 self-end"})]})]})}export{ue as default};
