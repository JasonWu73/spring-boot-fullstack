import{h as E,j as e,i as v,o as R,w as T,a as L,p as B,B as A,E as W,an as $,A as D,ao as H,ap as O}from"./index-f29c37fe.js";import{z as f,t as M}from"./index-a1d6eb7d.js";import{u as q,C as V,a as S,b as F,c as I,d as C,F as K,e as y,f as U}from"./CustomFormField-a6762e0b.js";import{S as h}from"./Skeleton-15b235d6.js";import{T as G,a as J,b as Q,c as X}from"./Tooltip-b0b070ef.js";import{a as Y}from"./use-refresh-e248a172.js";import{u as Z}from"./use-title-bfe6ef72.js";function z({onRate:s,maxRating:r=5,defaultRating:t=0,color:n="#f59e0b",size:a="default",isShowLabel:d=!0,className:u}){const[m,g]=E.useState(0),[o,j]=E.useState(0),c=te(a),b=Array.from({length:r*2},(p,l)=>l%2===0?l/2*c:l/2*c-c/2);function N(p){g(p),s(p)}return e.jsxs("ul",{className:v("relative flex items-center",u),style:{height:`${a}px`,width:`${r*c}px`},children:[Array.from({length:r*2},(p,l)=>e.jsx("li",{className:"absolute",style:{left:`${b[l]}px`,zIndex:l%2===0?10:0},children:e.jsx(ee,{color:n,size:c,type:l%2===0?"half":"full",isFilled:o?o*2>=l+1:m?m*2>=l+1:t/.5>=l+1,onRate:()=>N((l+1)/2),onHoverIn:()=>j((l+1)/2),onHoverOut:()=>j(0)})},l)),d&&e.jsx("li",{children:e.jsx("span",{className:v({"text-lg":a!=="sm"&&a!=="lg","text-sm":a==="sm","text-xl":a==="lg"}),style:{marginLeft:`${b[r*2-1]+c+6}px`,color:n},children:o||m||t||""})})]})}function ee({color:s,size:r,type:t="full",isFilled:n,onRate:a,onHoverIn:d,onHoverOut:u}){const m=t==="full"?se:re;return e.jsx("span",{onClick:a,onMouseEnter:d,onMouseLeave:u,className:v("peer cursor-pointer",n&&"border-amber-500"),children:e.jsx(m,{isFilled:n,color:s,size:r})})}function se({color:s="#f59e0b",isFilled:r,size:t=20}){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:r?s:"none",stroke:s,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-star",children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})}function re({color:s="#f59e0b",isFilled:r,size:t=20}){const n=t/2;return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:n,height:t,viewBox:`0 0 ${n+2} 24`,fill:r?s:"none",stroke:s,strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-star",children:e.jsx("path",{d:"M12 17.8 5.8 21 7 14.1 2 9.3l7-1L12 2"})})}function te(s){switch(s){case"sm":return 16;case"lg":return 22;default:return 20}}const P=[{value:"user",label:"您"},{value:"friend",label:"好友"}],ae=f.object({bill:f.coerce.number({invalid_type_error:"账单金额必须是数字"}).min(0,"账单金额必须大于或等于 0"),userExpense:f.coerce.number({invalid_type_error:"费用必须是数字"}).min(0,"费用必须大于或等于 0"),friendExpense:f.coerce.number({invalid_type_error:"费用必须是数字"}).min(0,"费用必须大于或等于 0"),whoIsPaying:f.string({required_error:"必须选择谁支付账单"}).refine(s=>P.map(({value:r})=>r).includes(s),{message:"必须是有效的选项：您 或 好友"})}).refine(({userExpense:s,bill:r})=>s<=r,{message:"您的费用必须小于或等于帐单",path:["userExpense"]}).refine(({userExpense:s,friendExpense:r,whoIsPaying:t})=>t==="user"&&s>0?!0:t==="friend"&&r>0,{message:"必须输入有效的费用",path:["userExpense"]}),ne={bill:0,userExpense:0,friendExpense:0,whoIsPaying:P[0].value};function ge(){var p,l,_;Z("分摊账单");const s=q({resolver:M(ae),defaultValues:ne}),r=R(),t=T(),n=Number(r.friendId);oe(s);const{data:a,error:d,loading:u,requestData:m,updateState:g}=L(N),{dispatch:o}=B();Y(()=>{s.reset(),j().then(({data:i,error:w})=>{if(w){o({type:"SELECT_FRIEND",payload:null});return}i&&o({type:"SELECT_FRIEND",payload:i})})});async function j(){return await m({url:"/fake",urlParams:{id:n}})}function c(i){const w=i.whoIsPaying==="user"?-i.friendExpense:i.userExpense;o({type:"SPLIT_BILL",payload:{id:n,expense:w}}),t(`/split-bill${window.location.search}`,{state:{noRefresh:!0}})}function b(i){o({type:"RATE_CREDIT_RANK",payload:{id:n,creditRating:i}})}async function N(i){$(),g(x=>({...x,loading:!0})),await D(2);const k=H().find(x=>x.id===Number(i.urlParams.id));return O(),g(x=>({...x,loading:!1})),k?{status:200,data:k}:{status:404,error:"未找到好友数据"}}return e.jsxs(V,{className:"bg-amber-100 text-slate-950 dark:bg-amber-100 dark:text-slate-950",children:[u&&e.jsx(le,{}),!u&&d&&e.jsx(ie,{message:d}),!u&&!d&&a&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsx(F,{children:"与好友分摊账单"}),e.jsxs(I,{className:"flex gap-1",children:["好友：",e.jsx(G,{children:e.jsxs(J,{children:[e.jsx(Q,{asChild:!0,className:"max-w-xs overflow-hidden text-ellipsis whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-cyan-500",children:a.name})}),e.jsx(X,{children:a.name})]})})]}),e.jsx(z,{defaultRating:a.creditRating,onRate:i=>b(i),size:"lg"})]}),e.jsx(C,{children:e.jsx(K,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(c),className:"flex flex-col gap-4",children:[e.jsx(y,{control:s.control,name:"bill",type:"number",label:"💰 账单金额",labelWidth:160,placeholder:"账单金额",isError:(p=s.getFieldState("bill"))==null?void 0:p.invalid,className:"bg-slate-50"}),e.jsx(y,{control:s.control,name:"userExpense",type:"number",label:"💸 您的费用",labelWidth:160,placeholder:"您的费用",isError:(l=s.getFieldState("userExpense"))==null?void 0:l.invalid,className:"bg-slate-50"}),e.jsx(y,{control:s.control,name:"friendExpense",type:"number",label:`👫 ${a.name} 的费用`,labelWidth:160,placeholder:`${a.name} 的费用`,className:"bg-slate-50",disabled:!0}),e.jsx(U,{control:s.control,name:"whoIsPaying",label:"🤑 谁付帐单",labelWidth:160,options:ce(a.name),isError:(_=s.getFieldState("whoIsPaying"))==null?void 0:_.invalid,className:"bg-slate-50"}),e.jsx(A,{type:"submit",className:"self-end",children:"分摊账单"})]})})})]})]})}function le(){return e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsx(F,{children:e.jsx(h,{className:"h-6 w-[300px]"})}),e.jsxs(I,{className:"space-y-2",children:[e.jsx(h,{className:"h-5 w-[300px]"}),e.jsx(h,{className:"h-6 w-[200px]"})]})]}),e.jsxs(C,{className:"flex flex-col gap-4",children:[Array.from({length:4},(s,r)=>e.jsxs("div",{className:"grid grid-flow-row items-center gap-2 lg:grid-cols-[auto_1fr]",children:[e.jsx(h,{className:"h-8 w-32"}),e.jsx(h,{className:"h-8"})]},r)),e.jsx(h,{className:"h-8 w-20 self-end"})]})]})}function ie({message:s}){return e.jsxs(S,{children:[e.jsxs(F,{className:"flex items-center gap-1 text-red-500",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"h-5",children:"分摊账单出错"})]}),e.jsx(I,{children:s})]})}function oe(s){const r=s.watch("bill"),t=s.watch("userExpense");E.useEffect(()=>{const n=Number(r),a=Number(t);a>n||s.setValue("friendExpense",Number((n-a).toFixed(2)))},[r,t,s])}function ce(s){const r=P.map(({value:t,label:n})=>({value:t,label:t==="friend"?s:n}));return r.push({value:"anonymous",label:"匿名"}),r}export{ge as SplitBill};
