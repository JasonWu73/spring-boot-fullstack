import{j as e,J as P,R as N,e as v,D as I,C as R,G as T,B as _}from"./index-132372d4.js";import{z as h,t as B}from"./index-8deb8405.js";import{a as y,b as E,c as S,d as C,u as W,C as $,F as L,e as w,j as H}from"./CustomFormField-e959eb86.js";import{S as p}from"./Skeleton-8fca72dd.js";import{u as O,a as A}from"./use-title-f4fa0656.js";import{T as M,a as D,b as V,c as q}from"./Tooltip-579ef7c8.js";function G({message:s}){return e.jsxs(y,{children:[e.jsxs(E,{className:"flex items-center gap-1 text-red-500",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{className:"h-5",children:"分摊账单出错"})]}),e.jsx(S,{children:s})]})}function J(){return e.jsxs(e.Fragment,{children:[e.jsxs(y,{children:[e.jsx(E,{children:e.jsx(p,{className:"h-6 w-[300px]"})}),e.jsxs(S,{className:"space-y-2",children:[e.jsx(p,{className:"h-5 w-[300px]"}),e.jsx(p,{className:"h-6 w-[200px]"})]})]}),e.jsxs(C,{className:"flex flex-col gap-4",children:[Array.from({length:4},(s,r)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx(p,{className:"h-8 w-32"}),e.jsx(p,{className:"h-8 w-full"})]},r)),e.jsx(p,{className:"h-8 w-20 self-end"})]})]})}function K({onRate:s,maxRating:r=5,defaultRating:n=0,color:l="#f59e0b",size:i="default",isShowLabel:u=!0,className:a}){const[o,b]=N.useState(0),[m,f]=N.useState(0),d=Y(i),g=Array.from({length:r*2},(x,t)=>t%2===0?t/2*d:t/2*d-d/2);function j(x){b(x),s(x)}return e.jsxs("ul",{className:v("relative flex items-center",a),style:{height:`${i}px`,width:`${r*d}px`},children:[Array.from({length:r*2},(x,t)=>e.jsx("li",{className:"absolute",style:{left:`${g[t]}px`,zIndex:t%2===0?10:0},children:e.jsx(Q,{color:l,size:d,type:t%2===0?"half":"full",isFilled:m?m*2>=t+1:o?o*2>=t+1:n/.5>=t+1,onRate:()=>j((t+1)/2),onHoverIn:()=>f((t+1)/2),onHoverOut:()=>f(0)})},t)),u&&e.jsx("li",{children:e.jsx("span",{className:v({"text-lg":i!=="sm"&&i!=="lg","text-sm":i==="sm","text-xl":i==="lg"}),style:{marginLeft:`${g[r*2-1]+d+6}px`,color:l},children:m||o||n||""})})]})}function Q({color:s,size:r,type:n="full",isFilled:l,onRate:i,onHoverIn:u,onHoverOut:a}){const o=n==="full"?U:X;return e.jsx("span",{onClick:i,onMouseEnter:u,onMouseLeave:a,className:v("peer cursor-pointer",l&&"border-amber-500"),children:e.jsx(o,{isFilled:l,color:s,size:r})})}function U({color:s="#f59e0b",isFilled:r,size:n=20}){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:r?s:"none",stroke:s,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-star",children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})}function X({color:s="#f59e0b",isFilled:r,size:n=20}){const l=n/2;return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:l,height:n,viewBox:`0 0 ${l+2} 24`,fill:r?s:"none",stroke:s,strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-star",children:e.jsx("path",{d:"M12 17.8 5.8 21 7 14.1 2 9.3l7-1L12 2"})})}function Y(s){switch(s){case"sm":return 16;case"lg":return 22;default:return 20}}const F=[{value:"user",label:"您"},{value:"friend",label:"好友"}],Z=h.object({bill:h.coerce.number({invalid_type_error:"账单金额必须是数字"}).min(0,"账单金额必须大于或等于 0"),userExpense:h.coerce.number({invalid_type_error:"费用必须是数字"}).min(0,"费用必须大于或等于 0"),friendExpense:h.coerce.number({invalid_type_error:"费用必须是数字"}).min(0,"费用必须大于或等于 0"),whoIsPaying:h.string({required_error:"必须选择谁支付账单"}).refine(s=>F.map(({value:r})=>r).includes(s),{message:"必须是有效的选项：您 或 好友"})}).refine(({userExpense:s,bill:r})=>s<=r,{message:"您的费用必须小于或等于帐单",path:["userExpense"]}).refine(({userExpense:s,friendExpense:r,whoIsPaying:n})=>n==="user"&&s>0?!0:n==="friend"&&r>0,{message:"必须输入有效的费用",path:["userExpense"]});function ie(){var j,x,t;O("分摊账单");const s=W({resolver:B(Z),defaultValues:{bill:0,userExpense:0,friendExpense:0,whoIsPaying:F[0].value}});ee(s);const r=I(),{loadingFriend:n,getFriend:l,setCredit:i,splitBill:u}=r;let{curFriend:a,errorFriend:o}=r;n&&(o="",a=null);const b=R(),m=Number(b.friendId);A(()=>{s.reset();const c=l({id:m});return()=>c()});const f=T();function d(c){const k=c.whoIsPaying==="user"?-c.friendExpense:c.userExpense;u(m,k),f(`/split-bill${window.location.search}`,{state:{noRefresh:!0}})}function g(c){i(m,c)}return e.jsxs($,{className:"w-96 bg-amber-100 text-slate-700 dark:bg-amber-100 dark:text-slate-700 md:w-[22rem] lg:w-[30rem]",children:[n&&e.jsx(J,{}),o&&e.jsx(G,{message:o}),a&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{children:[e.jsx(E,{children:"与好友分摊账单"}),e.jsxs(S,{className:"flex gap-1",children:["好友：",e.jsx(M,{children:e.jsxs(D,{children:[e.jsx(V,{asChild:!0,className:"max-w-xs overflow-hidden text-ellipsis whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-cyan-500",children:a.name})}),e.jsx(q,{children:a.name})]})})]}),e.jsx(K,{defaultRating:a.creditRating,onRate:c=>g(c),size:"lg"})]}),e.jsx(C,{children:e.jsx(L,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(d),className:"flex flex-col gap-4",children:[e.jsx(w,{control:s.control,name:"bill",type:"number",label:"💰 账单金额",labelWidth:160,placeholder:"账单金额",isError:(j=s.getFieldState("bill"))==null?void 0:j.invalid}),e.jsx(w,{control:s.control,name:"userExpense",type:"number",label:"💸 您的费用",labelWidth:160,placeholder:"您的费用",isError:(x=s.getFieldState("userExpense"))==null?void 0:x.invalid}),e.jsx(w,{control:s.control,name:"friendExpense",type:"number",label:`👫 ${a.name} 的费用`,labelWidth:160,placeholder:`${a.name} 的费用`,disabled:!0}),e.jsx(H,{control:s.control,name:"whoIsPaying",label:"🤑 谁付帐单",labelWidth:160,options:z(a.name),isError:(t=s.getFieldState("whoIsPaying"))==null?void 0:t.invalid}),e.jsx(_,{type:"submit",className:"self-end",children:"分摊账单"})]})})})]})]})}function z(s){const r=F.map(({value:n,label:l})=>({value:n,label:n==="friend"?s:l}));return r.push({value:"anonymous",label:"匿名"}),r}function ee(s){const{watch:r,setValue:n}=s,l=r("bill"),i=r("userExpense");N.useEffect(()=>{const u=Number(l),a=Number(i);a>u||n("friendExpense",Number((u-a).toFixed(2)))},[l,i,n])}export{ie as SplitBillForm};
